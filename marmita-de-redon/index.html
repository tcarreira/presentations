<!DOCTYPE html>
<html>
  <head>
    <title>Docker BÃ¡sico</title>
    <meta charset="utf-8" />
    <style>
      @import url(style.css);
    </style>
  </head>
  <body>
    <textarea id="source">


name: inverse
layout: true
class: center, middle, inverse

---

name: impact
layout: true
class: center, middle, impact, content

---

name: title
layout: true
class: title center

---

name: content
layout: true

---

template: title
name: main-title


.content[

<br><br><br><br><br><br><br><br><br><br><br><br>
### Nos bastidores do podcast

.small[
ou "como criar e manter um podcast a custo zero com Software Livre"
]


]

---

# Sobre mim
## Tiago Carreira

.left-column[


- Lisboa ðŸ‡µðŸ‡¹ &rarr; Rio de Janeiro ðŸ‡§ðŸ‡·
- Engenheiro DevOps<br>
- Hobbies:
.small[
- Desporto (correr, bicicleta, escalada)
- MÃºsica (clarinete, flauta, piano, guitarra)
- ProduÃ§Ã£o audiovisual (fotografia, vÃ­deo, **podcast**)
- Open Source
<br><br><br><br>
]
]

.rigth-column[
.center.pic-circle[
<!-- TODO: fix pic -->
<img src="img/tcarreira.jpg" width="180">
]

.center.no-bullets.tiny[
**site:** tiago.carreira.pw<br>
**telegram:** @tcarreira<br>
**github:** github.com/tcarreira<br>
**twitter:** @tiagogcarreira
]

]

---

layout: false
template: impact
name: agenda

# Agenda

- .not[CriaÃ§Ã£o do podcast]
- .not[GravaÃ§Ã£o e captura]
- .not[EdiÃ§Ã£o sonora]
- Website
- PublicaÃ§Ã£o
- AutomatizaÃ§Ã£o

---

template: impact
name: revisao

# O que Ã© um podcast
RevisÃ£o

---

# O que Ã© um podcast

- Ouvinte usa um Podcatcher (Spotify, iTunes, AntennaPod, cPod, gPodder, VLC, etc...)
- Podcatcher lÃª **Feed RSS** do podcast
  - metadados sobre o podcast e todos os episÃ³dios
- Podcatcher faz **download do Ã¡udio** atravÃ©s do link disponibilizado no Feed RSS
- Ouvinte ouve o episÃ³dio :)

???

- RSS Feed
- Audio alojado em servidores

---

template: impact
name: website

# Website

---


# Website

.left-column[
- Necessidades
  - visualmente simples
  - listar artigos (episÃ³dios) com imagem
  - suporte mobile
  - suporte de RSS feeds para podcast
  - nice-to-have: tema escuro
- Hugo
  - geraÃ§Ã£o de HTML estÃ¡tico
  - tema: [hugo-redon-podcast](https://github.com/marmita-de-redon/hugo-redon-podcast) <br>
      - fork de [hugo clarity](github.com/chipzoller/hugo-clarity)
      - baseado no [VMware Clarity design](https://clarity.design/)
- Alojamento com Github Pages
]

.right-column.center[
<br><br><br><br><br><br>
<img height="80px" src="img/hugo-logo-wide.svg">

<div>
  <img style="vertical-align:middle; margin-right:15px" height="80px" src="img/clarity-logo.svg">
  Clarity Design System
</div>
]

---

# Website

.center[
<img height="400px" style="border: 2px solid #2db4fd;" src="img/website-desktop.png">
<img height="400px" style="border: 2px solid #2db4fd;" src="img/website-mobile.png">
]

---

# Website

.left-column.tiny[
```
.
â”œâ”€â”€ config
â”‚   â””â”€â”€ _default
â”‚       â””â”€â”€ menus
â”‚           â””â”€â”€ menu.pt.toml
â”œâ”€â”€ config.toml
â”œâ”€â”€ content
â”‚   â”œâ”€â”€ _index.md
â”‚   â”œâ”€â”€ contactos.md
â”‚   â”œâ”€â”€ feed
â”‚   â”‚   â””â”€â”€ podcast
â”‚   â”‚       â””â”€â”€ _index.md
â”‚   â”œâ”€â”€ post
â”‚   â”‚   â”œâ”€â”€ _index.md
â”‚   â”‚   â”œâ”€â”€ s01e00.md
â”‚   â”‚   â”œâ”€â”€ s01e01.md
â”‚   â”‚   â”œâ”€â”€ s01e02.md
â”‚   â”‚   â”œâ”€â”€ s01e03.md
â”‚   â”‚   â”œâ”€â”€ s01e04.md
â”‚   â”‚   â”œâ”€â”€ s01e05.md
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ sobre.md
â”‚   â””â”€â”€ subscrever.md
â”œâ”€â”€ data
â”‚   â””â”€â”€ social.yaml
â””â”€â”€ ...
```
]
.right-column.tiny[
```yaml
+++
title = "#16 Brinquedos (parte 1)"
itunes_title = "Brinquedos (parte 1)"
episode = 16
podcast_file = "https://media.blubrry.com/marmitaderedon/archive.org/download/marmitaderedon-s01e16/s01e16-brinquedos_1.mp3"
podcast_duration = "0:19:30"
podcast_bytes = "28091404"
author = "Marmita de Redon"
date = "2021-01-01"
description = "Pega-monstros, berlindes, tazos, tragabolas... Qual era o vosso brinquedo de eleiÃ§Ã£o? "
thumbnail = "images/s01e16.jpg"

featured = false
aliases = ["s01e16", "S01E16", "16"]
+++

Na altura em que a internet ainda era uma miragem, 
esta malta brincava com coisas analÃ³gicas, feitas de um plÃ¡stico duvidoso dos anos 90. 
Yo-yoâ€™s ou diÃ¡bolos entretinham-nos por horas e os pega-monstros eram o terror das raparigas no recreio.

## AtribuiÃ§Ã£o e licenÃ§as
- **Produzido por:** Joana Sanches, Marco Seabra, Tiago Carreira e Tiago MaurÃ­cio.
- **Editado por:** Tiago Carreira.
- **MÃºsica**: [Redon dos 90](https://archive.org/details/redon90) de Tiago Carreira, estÃ¡ licenciada nos termos da [LicenÃ§a Creative Commons - AtribuiÃ§Ã£o 4.0 Internacional](http://creativecommons.org/licenses/by/4.0/).

Este episÃ³dio estÃ¡ licenciado nos termos da [LicenÃ§a Creative Commons - AtribuiÃ§Ã£o-SemDerivaÃ§Ãµes 4.0 Internacional](https://creativecommons.org/licenses/by-nd/4.0/) (CC BY-ND 4.0).
```
]

---

# Alojamento do website - Github Pages

.left-column[
- suporta html estÃ¡tico (e mais algumas coisas)
- (relativamente) fÃ¡cil
- permite domÃ­nio prÃ³prio
- HTTPS automÃ¡tico (mesmo para domÃ­nio prÃ³prio)
- sem manutenÃ§Ã£o
- gratuito

<br><br>

### Alojamento de ficheiros Ã¡udio
.center[
<img src="img/internet-archive.svg" height="60px">
]

]

.right-column[
<img height="400px" src="img/gh-pages.png" >
]

---

template: impact
name: publicacao

# PublicaÃ§Ã£o

---

# PublicaÃ§Ã£o

.left-column[
- gravar
- editar
- criar os textos para a descriÃ§Ã£o
- criar novo thumbnail
- upload dos ficheiros para o Archive.org
- criar novo vÃ­deo (para youtube)
- criar novo artigo (markdown)
- atualizar o site
]

---

# Fluxo de PublicaÃ§Ã£o

.center[
<img height="450px" src="img/fluxo_publicaÃ§Ã£o.drawio.svg">
]

---

# PublicaÃ§Ã£o

.left-column[
- gravar
- editar
- criar os textos para a descriÃ§Ã£o
- .not[criar novo thumbnail]
- .not[upload dos ficheiros para o Archive.org]
- .not[criar novo vÃ­deo (para youtube)]
- .not[criar novo artigo (markdown)]
- .not[atualizar o site]
]
.right-column[
- gravar
- editar
- criar os textos para a descriÃ§Ã£o
- **chamar um script que automatiza tudo** *

.tiny[
<br><br><br><br><br><br><br><br><br>
\* com exceÃ§Ã£o das redes sociais
]
]

???

limitaÃ§Ãµes na API do youtube, mas existe soluÃ§Ã£o https://github.com/ubuntupodcast/podpublish#youtube-api

---

template: impact
name: automatizacao

# AutomatizaÃ§Ã£o

---

# AutomatizaÃ§Ã£o

```bash
function .main() {
  .check_pre_requisites
  .print_and_check_info

  .generate_thumbnail
  .upload_audio_to_archive_org
  .render_video
  .upload_to_youtube
  .create_markdown_file
  .commit_and_push_website
}
```


---

# AutomatizaÃ§Ã£o

`.generate_thumbnail`

.small[
```
python create_thumbnail.py "../images/base_thumbnail.png" "${THUMBNAIL_PATH}" "#1 TÃ­tulo do EpisÃ³dio"
```
<br>
`create_thumbnail.py`
```python
img = Image.open(image_source)
img_rgb = img.convert('RGB')
draw = ImageDraw.Draw(img_rgb)

font = ImageFont.truetype("font.ttf", 300)
w, h = draw.textsize(text, font=font)
position = (center_x-w/2, center_y-h/2)

draw.text(position, text, align="center", fill=color, font=font)
img_rgb = img_rgb.resize((1024,1024), resample=Image.BICUBIC)
img_rgb.save(image_dest)
```
]

<img
  style="
    position: absolute;
    bottom: 140px;
    right: 100px;
    z-index: 200;
    border: 2px solid #2db4fd;"
  height="200px"
  src="img/s01e01.jpg"
>



---

# AutomatizaÃ§Ã£o

`.upload_audio_to_archive_org`

.small[
```
./ia upload "${ARCHIVE_ORG_IDENTIFIER}" \
      "${AUDIO_PATH}" \
      "${THUMBNAIL_PATH}" \
      --metadata="mediatype:audio" \
      --metadata="language:por" \
      --retries 5
```
]

---

# AutomatizaÃ§Ã£o

`.render_video`

.small[
```
ffmpeg \
  -loop 1 \
    -i "${THUMBNAIL_PATH}" \
    -i "${AUDIO_PATH}" \
  -shortest \
  -acodec copy \
  "${VIDEO_PATH}" -y
```
]
---

# AutomatizaÃ§Ã£o

`.upload_to_youtube`

.small[
```
jq -n -f "${YOUTUBE_TEMPLATE_JSON_PATH}" \
      --arg title "${YOUTUBE_TITLE}" \
      --arg description "${BODY_MD_TEXT}$(echo -e "\n\n")${FOOTER_MD_TEXT}" \
      --arg privacystatus "${YOUTUBE_PRIVACY_STATUS}" \
      --arg license "${YOUTUBE_LICENCE}" \
  | shoogle execute -c "${GOOGLE_CREDENTIALS_PATH}" youtube:v3.videos.insert - -f "${VIDEO_PATH}"
```
]

.left-column.tiny[
```json
{
  "part": "snippet,status",
  "body": {
    "snippet": {
      "title": $title,
      "description": $description
    },
    "status": {
      "license": $license,
      "privacyStatus": $privacystatus,
      "selfDeclaredMadeForKids": false
    }
  }
}
```
]
.right-column.small[
nota:

O shoogle usa uma API do youtube que nÃ£o permite fazer agendamento de publicaÃ§Ãµes.<br>
Mas parece haver soluÃ§Ãµes por aÃ­:

https://github.com/ubuntupodcast/podpublish#youtube-api

]

---

# AutomatizaÃ§Ã£o

`.create_markdown_file`

.small[
.left-column[

```
EPISODE_NUMBER=16                                                                                    # number, not string
TITLE="Brinquedos (parte 1)"                                                                         # title without episode number.
DESCRIPTION="Pega-monstros, berlindes, tazos, tragabolas... Qual era o vosso brinquedo de eleiÃ§Ã£o? " # Short description
AUDIO_PATH="../rendered/s01e16-brinquedos_1.mp3"                                                     # this file will be uploaded to archive.org
PUBLISHED_AT="2021-01-01"                                                                            # publish date. eg: 2020-01-31

BODY_MD_TEXT="
Na altura em que a internet ainda era uma miragem, 
esta malta brincava com coisas analÃ³gicas, feitas de um plÃ¡stico duvidoso dos anos 90. 
Yo-yoâ€™s ou diabolos entretinham-nos por horas e os pega-monstros eram o terror das raparigas no recreio.
"
```
```
echo "${MARKDOWN_TEMPLATE}" >"${_markdown_post_file}"
```

]
.right-column[
```
MARKDOWN_TEMPLATE="+++
title = \"#${EPISODE_NUMBER} ${TITLE}\"
itunes_title = \"${TITLE}\"
episode = ${EPISODE_NUMBER}
podcast_file = \"${AUDIO_URL}\"
podcast_duration = \"${AUDIO_DURATION}\"
podcast_bytes = \"${AUDIO_BYTES}\"
author = \"${AUTHOR}\"
date = \"${PUBLISHED_AT}\"
description = \"${DESCRIPTION}\"
thumbnail = \"${THUMBNAIL_URL}\"

featured = ${WEBSITE_FEATURED}
aliases = [\"${_SxxExx}\", \"${EPISODE_NUMBER}\"]
+++
${BODY_MD_TEXT}

${FOOTER_MD_TEXT}"
```
]
]
---

# AutomatizaÃ§Ã£o

`.commit_and_push_website`


.small[
```
git add "${POST_RELATIVE_PATH}"
git add "${POST_IMAGE_RELATIVE_PATH}"
git commit -m "Publishing s01e01.md + s01e01.jpg"
git push

```
]

---

# AutomatizaÃ§Ã£o

## Github Actions

.small[
```
jobs:
  deploy:
    runs-on: ubuntu-20.04
    steps:
      - name: Build
        run: |
          hugo --gc --minify --cleanDestinationDir
          [ -f ./CNAME ] && cp ./CNAME ./public/CNAME || true
          [ -f ./ALIAS ] && cp ./ALIAS ./public/ALIAS || true

      - name: Deploy
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./public
```
]


---

# AutomatizaÃ§Ã£o

## Github Actions (auto-publish)

.small[
```
on:
  schedule:
    # Every Friday at 1:00 (AM) UTC
    - cron:  '0 1 * * 5'
  push:
    branches:
      - main

```
]

---

template: impact

# That's all folks
<img src="img/warner-bros-michigan-j-frog-logo.png" height="340px">

---

# Para mais tarde

## Slides

- https://tcarreira.github.io/presentations/marmita-de-redon

## ConteÃºdos

- https://marmita.pt
- https://github.com/marmita-de-redon
  - site: https://github.com/marmita-de-redon/website
  - tema: https://github.com/marmita-de-redon/hugo-redon-podcast
  - automatizaÃ§Ã£o: https://github.com/marmita-de-redon/automation

---

template: title

<br><br><br><br><br><br><br><br><br><br><br>

.content[.align-center[
## Obrigado
]]

.center.small[
tiago.carreira.pw | github.com/tcarreira | telegram: @tcarreira
.tiny[
Autoria do Podcast: Joana Sanches, Marco Seabra, Tiago Carreira, Tiago MaurÃ­cio
]
]




    </textarea>
    <!--
    <script src="https://remarkjs.com/downloads/remark-latest.min.js">
    </script>
    -->
    <script src="remark-latest.min.js"></script>
    <script>
      var slideshow = remark.create({
        slideNumberFormat: "%current%",
        ratio: "16:9",
        highlightStyle: "monokai",
        highlightLines: true,
        highlightSpans: true,
      });
    </script>
    <script src="jquery.min.js"></script>
    <script>
      Array.from($(".remark-code-line")).forEach((el) => {
        el.innerHTML = el.innerHTML
          .replace(
            "&lt;--&gt;",
            '<span class="remark-code-line-highlighted-removed-bg">'
          )
          .replace("&lt;/--&gt;", "</span>");
        el.innerHTML = el.innerHTML
          .replace(
            "&lt;red&gt;",
            '<span class="remark-code-line-highlighted-red">'
          )
          .replace("&lt;/red&gt;", "</span>");
        el.innerHTML = el.innerHTML
          .replace(
            "&lt;-&gt;",
            '<span class="remark-code-line-highlighted-removed">'
          )
          .replace("&lt;/-&gt;", "</span>");
        el.innerHTML = el.innerHTML
          .replace(
            "&lt;+&gt;",
            '<span class="remark-code-line-highlighted-added">'
          )
          .replace("&lt;/+&gt;", "</span>");
        el.innerHTML = el.innerHTML
          .replace(
            "&lt;+&gt;",
            '<span class="remark-code-line-highlighted-added">'
          )
          .replace("&lt;/+&gt;", "</span>");
        el.innerHTML = el.innerHTML
          .replace("&lt;=&gt;", '<span class="remark-code-line-highlighted">')
          .replace("&lt;/=&gt;", "</span>");
        el.innerHTML = el.innerHTML
          .replace("&lt;=&gt;", '<span class="remark-code-line-highlighted">')
          .replace("&lt;/=&gt;", "</span>");
      });

      // Css hack (remove top margin if column has h2 inside)
      $(".left-column:has(h2)").addClass("remove-top-space");
      $(".right-column:has(h2)").addClass("remove-top-space");
    </script>
  </body>
</html>
